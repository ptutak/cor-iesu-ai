{% load i18n %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">
    <head>
        <title>{% trans "Cancel Registration" %}</title>
    </head>
    <body>
        <!-- Language Switcher -->
        <div style="background-color: #0d6efd; padding: 10px 0;">
            <div style="text-align: right; max-width: 1200px; margin: 0 auto; padding: 0 20px;">
                <div style="display: inline-block; position: relative;">
                    <select onchange="changeLanguage(this.value)" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 4px;">
                        {% get_current_language as LANGUAGE_CODE %}
                        <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>English</option>
                        <option value="pl" {% if LANGUAGE_CODE == 'pl' %}selected{% endif %}>Polski</option>
                        <option value="nl" {% if LANGUAGE_CODE == 'nl' %}selected{% endif %}>Nederlands</option>
                    </select>
                </div>
            </div>
        </div>

        <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <h1>{% trans "Cancel Registration" %}</h1>

        <p>
            <strong>{% trans "Are you sure you want to cancel your registration?" %}</strong>
        </p>

        <div
            style="
                background-color: #f8f9fa;
                border-left: 4px solid #dc3545;
                padding: 15px;
                margin: 20px 0;
            "
        >
            <p><strong>{% trans "Registration Details:" %}</strong></p>
            <p>
                {% trans "Collection:" %} {{ assignment.period_collection.collection.name }}
            </p>
            <p>{% trans "Period:" %} {{ assignment.period_collection.period.name }}</p>
        </div>

        <div
            style="
                background-color: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 15px;
                margin: 20px 0;
            "
        >
            <p><strong>{% trans "Email Verification Required" %}</strong></p>
            <p>{% trans "For privacy and security, please enter the email address used for registration to confirm deletion." %}</p>
        </div>

        <form method="post">
            {% csrf_token %}

            <div style="margin: 20px 0;">
                <label for="{{ form.email.id_for_label }}" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    {{ form.email.label }}
                </label>
                {{ form.email }}
                {% if form.email.help_text %}
                    <small style="display: block; color: #666; margin-top: 5px;">
                        {{ form.email.help_text }}
                    </small>
                {% endif %}
                {% if form.email.errors %}
                    <div style="color: #dc3545; margin-top: 5px;">
                        {% for error in form.email.errors %}
                            <small></small>{{ error }}</small>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            {% if form.non_field_errors %}
                <div style="color: #dc3545; margin: 20px 0;">
                    {% for error in form.non_field_errors %}
                        <p></p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <button
                type="submit"
                style="
                    background-color: #dc3545;
                    color: white;
                    padding: 10px 20px;
                    border: none;
                    cursor: pointer;
                "
            >
                {% trans "Yes, Cancel Registration" %}
            </button>
            <a href="/" style="margin-left: 10px">{% trans "Keep Registration" %}</a>
        </form>

        <p><small>{% trans "This action cannot be undone." %}</small></p>
        </div>

        <script>
            function changeLanguage(langCode) {
                // Create a form and submit to change language
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/i18n/setlang/';

                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;

                const langInput = document.createElement('input');
                langInput.type = 'hidden';
                langInput.name = 'language';
                langInput.value = langCode;

                const nextInput = document.createElement('input');
                nextInput.type = 'hidden';
                nextInput.name = 'next';
                nextInput.value = window.location.pathname;

                form.appendChild(csrfInput);
                form.appendChild(langInput);
                form.appendChild(nextInput);

                document.body.appendChild(form);
                form.submit();
            }
        </script>
    </body>
</html>
