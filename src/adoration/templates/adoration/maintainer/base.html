{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Maintainer Panel" %}{% endblock %}

{% block extra_css %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    .maintainer-sidebar {
        background-color: #f8f9fa;
        min-height: calc(100vh - 60px);
        border-right: 1px solid #dee2e6;
    }

    .maintainer-nav .nav-link {
        color: #495057;
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 0.25rem;
    }

    .maintainer-nav .nav-link:hover {
        background-color: #e9ecef;
        color: #212529;
    }

    .maintainer-nav .nav-link.active {
        background-color: #007bff;
        color: white;
    }

    .maintainer-nav .nav-link i {
        margin-right: 0.5rem;
        width: 1.25rem;
    }

    .stat-card {
        border: none;
        border-radius: 0.75rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        transition: transform 0.15s ease-in-out;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }

    .stat-icon {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: "â€º";
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 maintainer-sidebar p-3">
            <div class="d-flex flex-column">
                <h6 class="text-muted fw-bold mb-3">{% trans "MAINTAINER PANEL" %}</h6>

                <ul class="nav flex-column maintainer-nav">
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                           href="{% url 'maintainer:dashboard' %}">
                            <i class="fas fa-tachometer-alt"></i>
                            {% trans "Dashboard" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if 'collection' in request.resolver_match.url_name %}active{% endif %}"
                           href="{% url 'maintainer:collection_list' %}">
                            <i class="fas fa-folder"></i>
                            {% trans "Collections" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if 'period' in request.resolver_match.url_name %}active{% endif %}"
                           href="{% url 'maintainer:period_list' %}">
                            <i class="fas fa-clock"></i>
                            {% trans "Periods" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if 'assignment' in request.resolver_match.url_name %}active{% endif %}"
                           href="{% url 'maintainer:assignment_list' %}">
                            <i class="fas fa-users"></i>
                            {% trans "Assignments" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if 'promote' in request.resolver_match.url_name %}active{% endif %}"
                           href="{% url 'maintainer:user_promotion' %}">
                            <i class="fas fa-user-plus"></i>
                            {% trans "Promote Users" %}
                        </a>
                    </li>
                </ul>

                <hr class="my-3">

                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'registration' %}">
                            <i class="fas fa-home"></i>
                            {% trans "Back to Site" %}
                        </a>
                    </li>
                    {% if user.is_staff %}
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/">
                            <i class="fas fa-cog"></i>
                            {% trans "Admin Panel" %}
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'admin:logout' %}">
                            <i class="fas fa-sign-out-alt"></i>
                            {% trans "Logout" %}
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 col-lg-10 px-md-4">
            <!-- Breadcrumb -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a href="{% url 'maintainer:dashboard' %}">{% trans "Maintainer" %}</a>
                        </li>
                        {% block breadcrumb %}{% endblock %}
                    </ol>
                </nav>
                {% block page_actions %}{% endblock %}
            </div>

            <!-- Page title -->
            {% block page_header %}
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2">{% block page_title %}{% trans "Maintainer Panel" %}{% endblock %}</h1>
            </div>
            {% endblock %}

            <!-- Messages -->
            {% if messages %}
            <div class="row mb-3">
                <div class="col-12">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Page content -->
            {% block maintainer_content %}{% endblock %}
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<script>
// Common AJAX setup
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// Common function to show alerts
function showAlert(message, type = 'info') {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;

    // Insert at the top of the main content
    const mainContent = document.querySelector('main');
    const existingAlerts = mainContent.querySelector('.alert-container');

    if (existingAlerts) {
        existingAlerts.innerHTML = alertHtml;
    } else {
        const alertContainer = document.createElement('div');
        alertContainer.className = 'alert-container mb-3';
        alertContainer.innerHTML = alertHtml;
        mainContent.insertBefore(alertContainer, mainContent.firstChild);
    }
}
</script>
{% block extra_maintainer_js %}{% endblock %}
{% endblock %}
